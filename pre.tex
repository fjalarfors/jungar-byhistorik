\documentclass[a4paper,twoside,12pt]{book}
% Packages
\usepackage{polyglossia}
\setdefaultlanguage{swedish}
\usepackage{fontspec}
\usepackage{xunicode}
\usepackage{xltxtra}
\usepackage[parfill]{parskip}
\usepackage{calc}
\usepackage{etoolbox}
\usepackage{graphicx}
\usepackage[space]{grffile}
\usepackage{wrapfig}
\usepackage{url}
\usepackage{enumitem}
\usepackage{marginnote}
%\usepackage{needspace}
%\usepackage[top=Bcm, bottom=Hcm, outer=Ccm, inner=Acm, heightrounded, marginparwidth=Ecm, marginparsep=Dcm]{geometry}
\usepackage[
	unicode=true,
	colorlinks=true,
	urlcolor=black,
	linkcolor=black,
	citecolor=black,
	filecolor=black,
	pdfauthor={Fjalar Fors},
	pdftitle={Jungar byhistorik},
	pdfsubject={Byahistorik},
	pdfkeywords={Jeppo, Jungar, historik, byar, gÃ¥rdar}
]{hyperref}
\usepackage{bookmark}

\setmainfont[
	Path = typsnitt/LinLibertine/,
	Extension = .otf,
	UprightFont = LinLibertine_R,
	BoldFont = LinLibertine_RZ, % Linux Libertine O Regular Semibold
	ItalicFont = LinLibertine_RI,
	BoldItalicFont = LinLibertine_RZI,
]{Libertine}
\setsansfont[
	Path = typsnitt/LinLibertine/,
	Extension = .otf,
	UprightFont = LinBiolinum_R,
	BoldFont = LinBiolinum_RB,
	ItalicFont = LinBiolinum_RI,
]{Biolinum}

% Variables
\author{Fjalar Fors etc}
\title{Jungar byhistorik}
\pagestyle{plain}

% Settings
\setlist{nosep}
\setlist[enumerate,1]{label=\arabic*), ref=\arabic*}
\newlength{\jhoccupantskip}
\setlength{\jhoccupantskip}{1\parskip}
\addtolength{\jhoccupantskip}{1\baselineskip}
\setlength{\wrapoverhang}{\marginparwidth} % wrapfig intrusion on margin
\addtolength{\wrapoverhang}{\marginparsep} % - " -
\newlength{\jhoccupantstart}
\newlength{\jhoccupantstop}

% Commands
\makeatletter
\newcommand{\gobblepars}{%
	\@ifnextchar\par%
		{\expandafter\gobblepars\@gobble}%
		{}
}
\makeatother
\newcommand{\jhoccupant}[3]{%
	\message{start \the\jhoccupantstart}%
	\message{stop \the\jhoccupantstop}%
	\invisiblesubsection{#1}%
	\setlength{\jhoccupantstart}{\pagetotal}%
	\leavevmode%
	\marginnote{%
		\textbf{#1} \\ #2 \\ #3%
	}\gobblepars%
	%\setlength{\jhoccupantstop}{\pagetotal}%
}
\newcommand{\jhchapter}[1]{%
	\chapter*{#1}%
	\addcontentsline{toc}{chapter}{\protect#1}%
}
\newcommand{\jhsection}[1]{\section*{#1}}
\newcommand{\jhsubsection}[1]{\subsection*{#1}}
\newcommand{\jhhouse}[5]{%
	\section*{#1}%
	\addcontentsline{toc}{section}{\protect#1}

	R:nr #2 av #3 hemman Karta #4 nr \jhbold{#5}
}
\newcommand{\jhperson}[3]{#1, \textborn #2\notblank{#3}{ - \textdied #3}{}}
\makeatletter
\newcommand{\checkheight}[1]{%
  \par \penalty-100\begingroup%
  \setbox8=\hbox{#1}%
  \setlength{\dimen@}{\ht8}%
  \dimen@ii\pagegoal \advance\dimen@ii-\pagetotal
  \ifdim \dimen@>\dimen@ii
    \break
  \fi\endgroup}
\makeatother
\newcommand{\jhhousepic}[2]{%
	\begin{wrapfigure}{O}{0.5\textwidth}
		\vspace{-1\baselineskip}
		\centering
			\includegraphics[width=0.48\textwidth]{bilder/#1}
			\ifstrempty{#2}{}{{\footnotesize#2}}
	\end{wrapfigure}
}
\newcommand{\jhpic}[2]{
	\begin{figure}[h]
		\centering
			\includegraphics[width=1\textwidth]{bilder/#1}
			\ifstrempty{#2}{}{{\footnotesize#2}}
	\end{figure}
}
\newcommand\invisiblesection[1]{%
	\refstepcounter{section}%
	\addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}%
	\sectionmark{#1}
}
\makeatletter
\newcommand\invisiblesubsection[1]{%
%	\refstepcounter{section}%
	%\markboth{}
	\vskip \baselineskip
	%\addcontentsline{toc}{subsection}{\protect#1}%
	%\sectionmark{#1}
	\@afterheading%
}
\makeatother
\newcommand{\jhbold}[1]{\textbf{#1}}
\def\textborn {\char"2605\relax} %{\char"002A }
\def\textdied {\char"271D\relax} %{\char"2020 } %{\char"271D }

% Envs
\newenvironment{jhchildren}{\par\noindent Barn:\begin{enumerate}[label=\alph*)]}{\end{enumerate}}

% Document
\begin{document}
\frontmatter

\maketitle

\tableofcontents

\mainmatter
